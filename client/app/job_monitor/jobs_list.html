<link rel="stylesheet" href="static/job_monitor/job.css"/>

<div class="container">
<!-- first job section --->
	<div  class="row">
		<div ng-show="detail == true" class="table-responsive">
			<table class="table">	
				<tbody>
					<tr ng-repeat="hjob in parent_job" class="success">
						<td><a href="{{current_location}}/single_view/{{hjob.id}}">{{hjob.id}}</a></td>
						<td><p>{{hjob.task}}</p>  </td>
						<td><p>{{hjob.nbr}}</p></td>
						<td> <p>{{hjob.status}}</p>   </td>
						<td> <i class= "{{hjob.qc && 'icon-ok' || 'icon-remove' }}" ></i> </td>
						<td> <p>{{hjob.ts_created | date:'medium'}}</p>   </td>
						<td> <p>{{hjob.ts_started | date:'medium'}}</p>   </td>
						<td> <p>{{hjob.ts_ended | date:'medium'}}</p>   </td>
	         		</tr>
				</tbody>  
			</table>
		</div>
	</div>
<!-- first job section end here--->

<!-- plot section --->
	<div class="row">
		<div class="span12">   
			<div class="btn-group" >
				<button type="button" class="btn btn-primary" ng-model="$parent.type_task" btn-radio="'task'"    tooltip="plots element grouped by Task">Task</button>
				<button type="button" class="btn btn-primary" ng-model="$parent.type_task" btn-radio="'status'"  tooltip="plots element grouped by Status">Status</button>
				
			</div>  
			<div class="btn-group" >
				<button type="button" class="btn  " ng-model="selection" btn-radio="'pie_chart'"  >Pie Chart</button>
				<button type="button" class="btn " ng-model="selection" btn-radio="'bar_chart'" >Bar Chart</button>
				<button ng-show="detail == true" type="button" class="btn " ng-model="selection" btn-radio="'evolution'" >Evolution </button>
				<button ng-show="detail == true" type="button" class="btn " ng-model="selection" btn-radio="'zoom'" >Zoom </button>
				<button ng-show="detail == true" type="button" class="btn " ng-model="selection" btn-radio="'force_tree'" >Force Tree </button>
			</div>
			<div data-toggle="buttons-radio" ng-switch on="selection" >
				<span ng-switch-when="bar_chart"> <d3-bars data="filteredData" type="type_task" ></d3-bars>  </span>
				<span ng-switch-when="pie_chart"> <d3-pie data="filteredData" type="type_task" ></d3-pie>  </span>
				<span ng-switch-when="evolution"> <d3-lines data="filteredData" type="type_task" ></d3-lines>  </span>
				<span ng-switch-when="zoom"> <d3-zoom head= "parent_job" data="filteredData" type="type_task" ></d3-zoom>  </span>
				<span ng-switch-when="force_tree"><d3-forcetree head= "parent_job" data="filteredData" type="type_task" ></d3-forcetree> </span>
				<span ng-switch-default>default  </span>
			</div>
		</div> 
	</div>
<!-- plot section end here--->




	
	
	
<!-- filter section --->
	<div class="row">
		<div class="col-md-2">
		<!--Sidebar content-->
	 		Status filter
	 	</div>
	 	<div class="col-md-2">
			<select ng-model="status_filter" >
	     		<option value="!!">-- All Status --</option>
	     		<option ng-repeat="job in filteredData | unique:'status'" value="{{job.status}}">{{job.status}}</option>
	  			// unique options from the categories
			</select>
		</div>
		<div class="col-md-2">
			Task filter 
		</div>
		<div class="col-md-2">   
			<select ng-model="task_filter" >
				<option value="!!">-- All Tasks --</option>
	 			<option ng-repeat="job in filteredData | unique:'task'" value="{{job.task}}">{{job.task}}</option>
			</select>
		</div>
		<div  ng-show="detail == false" class="col-md-2">	 
			Production filter &nbsp; 
		</div>
		<div ng-show="detail == false" class="col-md-2">   
			<select ng-model="production_filter" >
	    		<option value="!!">-- All Jobs --</option>
	 			<option ng-repeat="production in productions " value="{{production.job_id}}">{{production.release}}</option>
			</select> 
			<br>
		</div>
	</div>     
       <!-- filter section end here---> 
<!-- data table section --->
	<div class="row">
		<div class="table-responsive">
			<table class="table  table-hover">	
				<thead>
					<tr>
						<th><a href="" ng-click="orderProp = 'id'; reverse=!reverse">ID</a></th>
						<th><a href="" ng-click="orderProp = 'task'; reverse=!reverse">Name</a></th>
						<th>Jobs</th>
						<th><a href="" ng-click="orderProp = 'status'; reverse=!reverse">Status</a></th>
						<th>QC</th>
						<th><a href="" ng-click="orderProp = 'ts_created'; reverse=!reverse">Created</a></th>
						<th><a href="" ng-click="orderProp = 'ts_started'; reverse=!reverse">Started</a></th>
						<th><a href="" ng-click="orderProp = 'ts_ended'; reverse=!reverse">Ended</a></th>
						<th>All subjobs</th>
						<th>One level subjobs</th> 
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="job in filteredData = (jobs | job_check:[production_filter,task_filter , status_filter]) | orderBy:orderProp:reverse | startFrom:(currentPage-1)*maxSize | limitTo:maxSize" ng-class="{ danger: (job.status == 'FAILED') }">
						<td><a href="{{current_location}}/single_view/{{job.id}}" tooltip-popup-delay='1000' tooltip-placement="left" tooltip="Click to see detail job info and quality controls">{{job.id}}</a></td>
						<td><p>{{job.task}}</p>  </td>
						<td><p>{{job.nbr}}</p></td>
						<td> <p>{{job.status}}</p>   </td>
						<td> <i ng-show="!(job.qc === undefined)" class= "{{job.qc && 'glyphicon glyphicon-ok' || 'glyphicon glyphicon-remove' }}" ></i> </td>
						<td> <p>{{job.ts_created | date:'medium'}}</p>   </td>
						<td> <p>{{job.ts_started | date:'medium'}}</p>   </td>
						<td> <p>{{job.ts_ended | date:'medium'}}</p>   </td>
	          			<td class = "text-center"> <a ng-show="job.nbr > 0"  href="{{current_location}}/detail_view/{{job.id}}/99" class="btn btn-primary" tooltip-popup-delay='1000'  tooltip="Click to access all child jobs"><i   class="glyphicon glyphicon-list" ></i></a> </td>
						<td class = "text-center"> <a ng-show="job.nbr > 0"  href="{{current_location}}/detail_view/{{job.id}}/1" class="btn btn-primary" tooltip-popup-delay='1000'  tooltip="Click to access one level depth child jobs" ><i   class="glyphicon glyphicon-circle-arrow-down" ></i></a> </td>
	         		</tr>
				</tbody>  
			</table>
			<pagination total-items="filteredData.length" page="currentPage"></pagination>
		</div>
	</div>	
</div>